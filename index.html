<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RK KNIT FAB ‚Äî Order Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
/* ===== THEME ===== */
body.dark{
  background:
    radial-gradient(1200px 600px at 10% -10%, #7dd3fc44, transparent),
    radial-gradient(1000px 600px at 110% 10%, #c084fc33, transparent),
    linear-gradient(180deg,#0b1220,#0b1220 40%,#0e1426 100%);
  color:#e2e8f0;
}
body.light{ background:#f7fbff; color:#0f172a; }

.glass.dark{ backdrop-filter: blur(12px); background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.14); }
.glass.light{ background:#ffffffee; backdrop-filter: blur(10px); border:1px solid #e2e8f0; }

/* ===== STATUS CHIPS ===== */
.chip{
  padding:.25rem .6rem;
  border-radius:9999px;
  font-weight:700;
  font-size:.7rem;
  line-height:1;
  white-space:nowrap;
}
.st-process{ background:#2563eb; color:#e5f2ff }
.st-getting{ background:#38bdf8; color:#04293a }
.st-ready{ background:#facc15; color:#422006 }
.st-dispatched{ background:#22c55e; color:#052e18 }

/* ===== PIPELINE (PENDING) ===== */
.st-pipeline{
  background: linear-gradient(90deg,#f59e0b,#fbbf24,#f59e0b);
  color:#422006;
  background-size:200% 100%;
  animation:pipelineMove 2s linear infinite;
}
@keyframes pipelineMove{
  from{ background-position:0% 0 }
  to{ background-position:200% 0 }
}

/* ===== MOBILE ===== */
@media (max-width:640px){
  .chip{ font-size:.65rem }
}
</style>
</head>

<body class="dark min-h-screen">

<header class="max-w-6xl mx-auto px-4 pt-8 pb-6">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl sm:text-3xl font-bold">
      üßµ RK KNIT FAB ‚Äî <span class="text-sky-300">Order Tracker</span>
    </h1>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 pb-20 space-y-6">

<section id="results" class="space-y-4"></section>

</main>

<script>
const API = 'https://script.google.com/macros/s/AKfycbzFljZhpwmAR-BANlmSYbtvCC36T0qyrbcMUGbQc8f4RBDi8jIIR39YJzaAZMS5dqBa/exec';
const partyKey = new URLSearchParams(location.search).get('party');

function fmtDate(v){
  if(!v) return '-';
  const d=new Date(v);
  if(isNaN(d)) return v;
  return `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getFullYear()).slice(-2)}`;
}

function statusMeta(s){
  s=(s||'').toUpperCase();
  if(s==='READY') return {t:'READY',c:'st-ready'};
  if(s==='GETTING READY') return {t:'GETTING READY',c:'st-getting'};
  if(s==='DISPATCHED') return {t:'DISPATCHED',c:'st-dispatched'};
  if(s==='PENDING') return {t:'IN PIPELINE',c:'st-pipeline'};
  return {t:'IN PROCESS',c:'st-process'};
}

function groupByPI(rows){
  const m={};
  rows.forEach(r=>{
    (m[r.PI_No||'NO-PI']=m[r.PI_No||'NO-PI']||[]).push(r);
  });
  return m;
}

async function load(){
  const u=new URL(API);
  u.searchParams.set('party', partyKey || 'PREVIEW');
  const j=await (await fetch(u)).json();
  render(j.data||[]);
}

function render(rows){
  const groups=groupByPI(rows);
  document.getElementById('results').innerHTML=
    Object.keys(groups).map(pi=>`
    <div class="glass dark rounded-3xl overflow-hidden">

      <div class="p-4 border-b border-white/10 font-bold">PI: ${pi}</div>

      <!-- DESKTOP -->
      <div class="hidden sm:block">
        <div class="grid grid-cols-12 px-4 py-2 text-xs uppercase opacity-60 border-b border-white/10">
          <div class="col-span-4">Item</div>
          <div class="col-span-4 text-center">Ordered ‚Üí Expected</div>
          <div class="col-span-2 text-center">Qty</div>
          <div class="col-span-2 text-center">Status</div>
        </div>

        ${groups[pi].map(r=>{
          const m=statusMeta(r.Status);
          return `
          <div class="grid grid-cols-12 px-4 py-4 border-b border-white/10 last:border-b-0">
            <div class="col-span-4">
              <div class="font-semibold">${r.Item||'-'}</div>
              <div class="text-sm opacity-70">${r.Colour||'-'}</div>
            </div>
            <div class="col-span-4 text-center">
              ${fmtDate(r['Order Date'])} ‚Üí ${fmtDate(r.Expected_Delivery)}
            </div>
            <div class="col-span-2 text-center font-semibold">${r.Qty||'-'}</div>
            <div class="col-span-2 text-center">
              <span class="chip ${m.c}">${m.t}</span>
            </div>
          </div>`;
        }).join('')}
      </div>

      <!-- MOBILE -->
      <div class="sm:hidden divide-y divide-white/10">
        ${groups[pi].map(r=>{
          const m=statusMeta(r.Status);
          return `
          <div class="p-4 space-y-2">
            <div class="flex justify-between items-start">
              <div>
                <div class="font-semibold">${r.Item||'-'}</div>
                <div class="text-sm opacity-70">${r.Colour||'-'}</div>
              </div>
              <span class="chip ${m.c}">${m.t}</span>
            </div>

            <div class="font-semibold">Qty: ${r.Qty||'-'}</div>

            ${r.Remarks && String(r.Remarks).trim()!=='' ? `
              <div class="text-xs opacity-75 border-l-2 border-white/20 pl-2">
                üìù ${r.Remarks}
              </div>` : ``}

            <div class="rounded-xl bg-white/5 px-3 py-2 text-sm">
              <div class="text-xs opacity-70">Ordered ‚Üí Expected</div>
              ${fmtDate(r['Order Date'])} ‚Üí ${fmtDate(r.Expected_Delivery)}
            </div>
          </div>`;
        }).join('')}
      </div>

    </div>`).join('');
}

load();
</script>
</body>
</html>
