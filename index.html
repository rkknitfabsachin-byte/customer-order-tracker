<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Order Tracker — RK KNIT FAB</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
  body.dark{
    background:
      radial-gradient(1200px 600px at 10% -10%, #7dd3fc44, transparent),
      radial-gradient(1000px 600px at 110% 10%, #c084fc33, transparent),
      linear-gradient(180deg,#0b1220,#0b1220 40%,#0e1426 100%);
    color:#e2e8f0;
  }
  body.light{ background:#f7fbff; color:#0f172a; }

  .glass.dark{ backdrop-filter: blur(12px); background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.14); }
  .glass.light{ background:#ffffffee; backdrop-filter: blur(10px); border:1px solid #e2e8f0; box-shadow:0 10px 25px rgba(2,132,199,.06); }

  .chip{ padding:.22rem .65rem; border-radius:9999px; font-weight:700; font-size:.72rem }
  .st-process{ background:#1d4ed8; color:#e5f2ff; }
  .st-ready{ background:#34d399; color:#052e18; }
  .st-delayed{ background:#fca5a5; color:#3b0a0a; }
  .st-dispatched{ background:#93c5fd; color:#081225; }

  @keyframes spin{ to{ transform:rotate(360deg);} }
  @keyframes pulse{ 0%,100%{transform:scale(1);} 50%{transform:scale(1.08);} }
  @keyframes shake{ 0%,100%{transform:translateX(0);} 25%{transform:translateX(-4px);} 75%{transform:translateX(4px);} }
  @keyframes drive{ 0%{transform:translateX(-14px);} 100%{transform:translateX(14px);} }
  @keyframes fadeSlide{ from{opacity:0; transform:translateY(10px);} to{opacity:1;} }

  .ico-gear{ animation: spin 1.4s linear infinite; }
  .ico-check{ animation: pulse 1.6s ease-in-out infinite; }
  .ico-clock{ animation: shake 1.2s ease-in-out infinite; }
  .ico-truck{ animation: drive 1.2s ease-in-out infinite alternate; }
  .fade-in{ animation: fadeSlide .45s ease both; }
</style>
</head>

<body class="dark min-h-screen">

<main class="max-w-6xl mx-auto px-4 py-10">

<section id="results" class="space-y-4"></section>

</main>

<script>
/* ===== CONFIG ===== */
const API = 'https://script.google.com/macros/s/AKfycbzFljZhpwmAR-BANlmSYbtvCC36T0qyrbcMUGbQc8f4RBDi8jIIR39YJzaAZMS5dqBa/exec';

/* ===== PARTY KEY ===== */
const params = new URLSearchParams(location.search);
const partyKey = (params.get('party')||'').trim().toUpperCase();

/* ===== HELPERS ===== */
function fmtDate(v){
  if(!v) return '-';
  const d=new Date(v);
  if(isNaN(d)) return v;
  const dd=String(d.getDate()).padStart(2,'0');
  const mm=String(d.getMonth()+1).padStart(2,'0');
  const yy=String(d.getFullYear()).slice(-2);
  return `${dd}/${mm}/${yy}`;
}

function statusMeta(s){
  s=(s||'').toUpperCase();
  if(s==='READY') return {label:'READY', chip:'st-ready', icon:'check'};
  if(s==='DELAYED') return {label:'DELAYED', chip:'st-delayed', icon:'clock'};
  if(s==='DISPATCHED') return {label:'DISPATCHED', chip:'st-dispatched', icon:'truck'};
  return {label:'IN PROCESS', chip:'st-process', icon:'gear'};
}

function iconSVG(kind){
  if(kind==='check') return `<svg class="ico-check" width="22" height="22" viewBox="0 0 24 24"><path d="M20 7L10 17l-6-6" stroke="currentColor" stroke-width="2" fill="none"/></svg>`;
  if(kind==='clock') return `<svg class="ico-clock" width="22" height="22" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8.5" stroke="currentColor" stroke-width="2"/><path d="M12 7v5l3 2" stroke="currentColor" stroke-width="2"/></svg>`;
  if(kind==='truck') return `<svg class="ico-truck" width="22" height="22" viewBox="0 0 24 24"><path d="M2 7h11v8H2zM13 10h4l3 3v2h-7" stroke="currentColor" stroke-width="2"/><circle cx="6" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></svg>`;
  return `<svg class="ico-gear" width="22" height="22" viewBox="0 0 24 24"><path d="M12 8.5a3.5 3.5 0 1 1 0 7" stroke="currentColor" stroke-width="2"/></svg>`;
}

function groupByPI(rows){
  const m={};
  rows.forEach(r=>{
    const k=r.PI_No||'NO-PI';
    (m[k]=m[k]||[]).push(r);
  });
  return m;
}

/* ===== LOAD ===== */
async function load(){
  if(!partyKey){
    results.innerHTML='<div class="glass dark p-6 rounded-2xl text-center text-rose-400">❌ Invalid link</div>';
    return;
  }
  const url=new URL(API); url.searchParams.set('party',partyKey);
  const res=await fetch(url); const json=await res.json();
  render(json.data||[]);
}

function render(rows){
  const groups=groupByPI(rows);
  results.innerHTML=Object.keys(groups).map(pi=>{
    const items=groups[pi];
    return `
    <div class="glass dark rounded-3xl overflow-hidden fade-in">
      <div class="p-5 border-b border-white/10 font-bold text-lg">PI: ${pi}</div>
      <div class="divide-y border-white/10">
        ${items.map(r=>{
          const m=statusMeta(r.Status);
          return `
          <div class="grid grid-cols-12 gap-2 px-4 py-4 items-center">
            <div class="col-span-4">
              <div class="font-semibold text-[15px]">${r.Item||'-'}</div>
              <div class="text-sm opacity-70">${r.Colour||'-'}</div>
              <div class="text-xs opacity-70 mt-1">
                Expected: ${fmtDate(r.Expected_Delivery)}
              </div>
            </div>
            <div class="col-span-3 text-sm">${fmtDate(r.Date)}</div>
            <div class="col-span-2 text-sm">${r.Qty||'-'}</div>
            <div class="col-span-3">
              <span class="chip ${m.chip}">${m.label}</span>
            </div>
          </div>`;
        }).join('')}
      </div>
    </div>`;
  }).join('');
}

load();
</script>

</body>
</html>
